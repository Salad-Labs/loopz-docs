"use strict";(self.webpackChunksdk=self.webpackChunksdk||[]).push([[5320],{5787:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>d,frontMatter:()=>s,metadata:()=>i,toc:()=>c});var i=n(8476),o=n(4848),a=n(8453);const s={slug:"evolution-of-authentication-loopz-sdk",title:"From Privy to OTP: The Evolution of Authentication in Loopz SDK",authors:["mattiamigliore"],tags:["authentication","architecture","web3","development"],date:new Date("2024-01-15T00:00:00.000Z")},r="From Privy to OTP: The Evolution of Authentication in Loopz SDK",l={authorsImageUrls:[void 0]},c=[{value:"The Initial Architecture",id:"the-initial-architecture",level:2},{value:"The Problem Emerges",id:"the-problem-emerges",level:2},{value:"The Cost Factor",id:"the-cost-factor",level:2},{value:"The Hybrid Solution",id:"the-hybrid-solution",level:2},{value:"1. Custom OTP Authentication for App Access",id:"1-custom-otp-authentication-for-app-access",level:3},{value:"2. Privy for Blockchain Operations Only",id:"2-privy-for-blockchain-operations-only",level:3},{value:"The Technical Implementation",id:"the-technical-implementation",level:2},{value:"The Results",id:"the-results",level:2},{value:"Lessons Learned",id:"lessons-learned",level:2},{value:"Code Artifacts and Legacy",id:"code-artifacts-and-legacy",level:2},{value:"Looking Forward",id:"looking-forward",level:2}];function h(e){const t={code:"code",em:"em",h2:"h2",h3:"h3",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.p,{children:"When we first started building the Loopz SDK, we made what seemed like an obvious choice: use Privy for all authentication. After all, we were building a Web3 trading platform, and Privy offered seamless wallet connections with social logins. However, as our platform evolved, we discovered that what works for simple DApps doesn't always scale for complex applications with real-time features."}),"\n",(0,o.jsx)(t.h2,{id:"the-initial-architecture",children:"The Initial Architecture"}),"\n",(0,o.jsx)(t.p,{children:"Our initial authentication flow was straightforward:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"// Original implementation (simplified)\nconst { login } = usePrivy()\n\nconst authenticate = async () => {\n  const user = await login()\n  // User authenticated with wallet/social/email via Privy\n  return user\n}\n"})}),"\n",(0,o.jsx)(t.p,{children:"Everything went through Privy - wallet connections, email authentication, social logins. It was elegant and simple."}),"\n",(0,o.jsx)(t.h2,{id:"the-problem-emerges",children:"The Problem Emerges"}),"\n",(0,o.jsxs)(t.p,{children:["As we developed our real-time chat feature, we hit a major roadblock: ",(0,o.jsx)(t.strong,{children:"Privy's JWT tokens expire after just 1 hour"}),"."]}),"\n",(0,o.jsx)(t.p,{children:"For a trading platform where users might browse NFTs for a few minutes, this wasn't an issue. But for a chat application where users stay connected for hours, it became a nightmare:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"// The dreaded token expiration during active chat\nWebSocket disconnected: 401 Unauthorized\nToken expired while user was mid-conversation\n"})}),"\n",(0,o.jsx)(t.p,{children:"Imagine typing a long message about a trade, hitting send, and getting logged out. Not exactly the user experience we were aiming for."}),"\n",(0,o.jsx)(t.h2,{id:"the-cost-factor",children:"The Cost Factor"}),"\n",(0,o.jsxs)(t.p,{children:["Beyond the technical limitations, there was another consideration: ",(0,o.jsx)(t.strong,{children:"cost"}),". Privy's pricing model made sense for simple authentication needs, but for an application where users might authenticate multiple times per day due to token expiration, the costs started adding up quickly."]}),"\n",(0,o.jsx)(t.h2,{id:"the-hybrid-solution",children:"The Hybrid Solution"}),"\n",(0,o.jsx)(t.p,{children:"Instead of completely abandoning Privy, we developed a hybrid approach that leverages the best of both worlds:"}),"\n",(0,o.jsx)(t.h3,{id:"1-custom-otp-authentication-for-app-access",children:"1. Custom OTP Authentication for App Access"}),"\n",(0,o.jsx)(t.p,{children:"We built our own email/SMS OTP system for primary authentication:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:'// New OTP-based authentication\nconst requestOtpCode = async (email: string) => {\n  const response = await fetch("/auth/request-code", {\n    method: "POST",\n    body: JSON.stringify({ email }),\n  })\n  // Send 6-digit code via email\n}\n\nconst verifyOtpCode = async (email: string, code: string) => {\n  const response = await fetch("/auth/verify-code", {\n    method: "POST",\n    body: JSON.stringify({ email, code }),\n  })\n  // Returns JWT with 18-hour expiration\n  return response.json()\n}\n'})}),"\n",(0,o.jsx)(t.h3,{id:"2-privy-for-blockchain-operations-only",children:"2. Privy for Blockchain Operations Only"}),"\n",(0,o.jsx)(t.p,{children:"We kept Privy, but only for when users need to interact with the blockchain:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"// Privy is now only used when creating orders\nconst createOrder = async () => {\n  // Check if wallet is connected\n  const wallet = account.getActiveWallets()[0]\n\n  if (!wallet) {\n    // NOW we trigger Privy\n    // User connects wallet only when needed\n  }\n\n  // Execute blockchain transaction\n  await order.create(wallet, ...)\n}\n"})}),"\n",(0,o.jsx)(t.h2,{id:"the-technical-implementation",children:"The Technical Implementation"}),"\n",(0,o.jsx)(t.p,{children:"The refactoring wasn't trivial. We had to:"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:"Maintain Backward Compatibility"}),": Keep the existing API surface while changing the underlying implementation"]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:"Handle Legacy Code"}),": Deal with remnants of the old system (those ",(0,o.jsx)(t.code,{children:"link"}),"/",(0,o.jsx)(t.code,{children:"unlink"})," methods you might notice)"]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:"Separate Concerns"}),": Clearly distinguish between app authentication and blockchain authentication"]}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:"Here's how the new architecture looks:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"// App authentication (OTP)\nLoopzAuth Component\n  \u251c\u2500\u2500 Handles email/SMS OTP flow\n  \u251c\u2500\u2500 Manages JWT tokens (18-hour expiry)\n  \u2514\u2500\u2500 Controls the authentication UI\n\n// Blockchain authentication (Privy)\nOrder.init(wallet)\n  \u251c\u2500\u2500 Triggered only for blockchain operations\n  \u251c\u2500\u2500 Uses Privy for wallet connection\n  \u2514\u2500\u2500 Minimal token expiration impact\n"})}),"\n",(0,o.jsx)(t.h2,{id:"the-results",children:"The Results"}),"\n",(0,o.jsx)(t.p,{children:"The benefits of this hybrid approach have been significant:"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:"Better User Experience"}),": Users stay logged in for entire trading sessions without interruption"]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:"Reduced Costs"}),": Dramatic reduction in authentication costs"]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:"Improved Chat Stability"}),": No more disconnections due to token expiration"]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:"Flexible Authentication"}),": Users don't need a wallet just to browse and chat"]}),"\n"]}),"\n",(0,o.jsx)(t.h2,{id:"lessons-learned",children:"Lessons Learned"}),"\n",(0,o.jsx)(t.p,{children:"This evolution taught us several valuable lessons:"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:"One Size Doesn't Fit All"}),": What works for simple DApps might not work for complex applications"]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:"Cost Matters at Scale"}),": Always model costs based on realistic usage patterns"]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:"User Experience Trumps Elegance"}),": A slightly more complex architecture is worth it for a better UX"]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.strong,{children:"Incremental Migration"}),": You don't have to throw everything away - hybrid solutions can work"]}),"\n"]}),"\n",(0,o.jsx)(t.h2,{id:"code-artifacts-and-legacy",children:"Code Artifacts and Legacy"}),"\n",(0,o.jsx)(t.p,{children:"If you dig through our codebase, you'll still find remnants of the old system:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"// These methods are legacy - no longer functional\nconst link = useCallback((method: AuthLinkMethod) => {\n  // Legacy Privy integration\n}, [])\n\nconst unlink = useCallback((method: AuthLinkMethod) => {\n  // Legacy Privy integration\n}, [])\n"})}),"\n",(0,o.jsx)(t.p,{children:"We kept these to maintain API compatibility, but they're essentially non-functional now."}),"\n",(0,o.jsx)(t.h2,{id:"looking-forward",children:"Looking Forward"}),"\n",(0,o.jsx)(t.p,{children:"This architectural evolution has positioned us well for future growth. We can now:"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"Support users who want to chat and browse without wallets"}),"\n",(0,o.jsx)(t.li,{children:"Offer extended sessions for better user experience"}),"\n",(0,o.jsx)(t.li,{children:"Keep costs predictable as we scale"}),"\n",(0,o.jsx)(t.li,{children:"Maintain security where it matters most (blockchain operations)"}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:"The journey from a Privy-only solution to our hybrid approach shows that sometimes the best architecture isn't the simplest one - it's the one that best serves your users' needs."}),"\n",(0,o.jsx)(t.hr,{}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.em,{children:"Have you faced similar authentication challenges in your Web3 projects? We'd love to hear about your experiences and solutions!"})})]})}function d(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>r});var i=n(6540);const o={},a=i.createContext(o);function s(e){const t=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),i.createElement(a.Provider,{value:t},e.children)}},8476:e=>{e.exports=JSON.parse('{"permalink":"/loopz-docs/blog/evolution-of-authentication-loopz-sdk","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2024-01-15-evolution-of-authentication-loopz-sdk.md","source":"@site/blog/2024-01-15-evolution-of-authentication-loopz-sdk.md","title":"From Privy to OTP: The Evolution of Authentication in Loopz SDK","description":"When we first started building the Loopz SDK, we made what seemed like an obvious choice: use Privy for all authentication. After all, we were building a Web3 trading platform, and Privy offered seamless wallet connections with social logins. However, as our platform evolved, we discovered that what works for simple DApps doesn\'t always scale for complex applications with real-time features.","date":"2024-01-15T00:00:00.000Z","tags":[{"inline":true,"label":"authentication","permalink":"/loopz-docs/blog/tags/authentication"},{"inline":true,"label":"architecture","permalink":"/loopz-docs/blog/tags/architecture"},{"inline":true,"label":"web3","permalink":"/loopz-docs/blog/tags/web-3"},{"inline":true,"label":"development","permalink":"/loopz-docs/blog/tags/development"}],"readingTime":3.91,"hasTruncateMarker":true,"authors":[{"name":"Mattia Migliore","title":"Full Stack Developer, Web3 Dev, Co-founder & CTO Salad Labs","url":"https://www.linkedin.com/in/mattia-migliore-44886090/","page":{"permalink":"/loopz-docs/blog/authors/mattiamigliore"},"socials":{"x":"https://x.com/iamNFTia","linkedin":"https://www.linkedin.com/in/mattia-migliore-44886090/","github":"https://github.com/mattiNFT"},"imageURL":"https://media.licdn.com/dms/image/v2/D4D03AQGgX6OKMrEJig/profile-displayphoto-shrink_400_400/profile-displayphoto-shrink_400_400/0/1689936218116?e=1756339200&v=beta&t=J2TEZjssXl4PIkLrpfZNO48c74lzVb1hdeUCJW9FryA","key":"mattiamigliore"}],"frontMatter":{"slug":"evolution-of-authentication-loopz-sdk","title":"From Privy to OTP: The Evolution of Authentication in Loopz SDK","authors":["mattiamigliore"],"tags":["authentication","architecture","web3","development"],"date":"2024-01-15T00:00:00.000Z"},"unlisted":false,"prevItem":{"title":"Building a Real-Time Encrypted Chat System for Web3 Trading","permalink":"/loopz-docs/blog/building-encrypted-chat-web3"}}')}}]);